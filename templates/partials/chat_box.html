<div class="flex flex-col h-[500px]" 
     hx-get="/group/{{ group_id }}/chat/{{ other_user.id }}" 
     hx-trigger="every 5s" 
     hx-swap="outerHTML">

    <!-- Chat Header -->
    <div class="p-4 border-b border-white/10 flex justify-between items-center bg-black/20">
        <h3 class="font-bold flex items-center gap-2">
            {% if is_he_santa %}
                <span class="text-2xl">ðŸŽ…</span>
                <div>
                    <span class="block text-white">Santa Secreto</span>
                    <span class="text-xs text-gray-400 font-normal">Nadie sabe quiÃ©n es...</span>
                </div>
            {% else %}
                <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-xs">
                    {{ other_user.name[0]|upper }}
                </div>
                <div>
                    <span class="block text-white">{{ other_user.name }}</span>
                    {% if am_i_santa %}
                        <span class="text-xs text-indigo-300 font-normal"><i class="ph-fill ph-mask-happy"></i> EstÃ¡s en modo incÃ³gnito</span>
                    {% endif %}
                </div>
            {% endif %}
        </h3>
        <button onclick="document.getElementById('chat-modal').close()" class="text-gray-400 hover:text-white">
            <i class="ph-bold ph-x text-xl"></i>
        </button>
    </div>

    <!-- Messages Area -->
    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-black/10 scroll-smooth">
        {% for msg in messages %}
            {% set is_me = msg.sender_id == current_user.id %}
            <div class="flex {{ 'justify-end' if is_me else 'justify-start' }}">
                <div class="max-w-[75%] rounded-2xl px-4 py-2 text-sm shadow-sm relative {{ 'bg-indigo-600 text-white rounded-tr-none' if is_me else 'bg-gray-700 text-gray-100 rounded-tl-none' }}">
                    <p>{{ msg.content }}</p>
                    <span class="text-[10px] opacity-60 block mt-1 text-right">
                        {{ msg.timestamp.strftime('%H:%M') }}
                    </span>
                </div>
            </div>
        {% endfor %}
        {% if not messages %}
            <div class="text-center text-gray-500 text-sm mt-10 italic">
                No hay mensajes aÃºn. Â¡Rompe el hielo!
            </div>
        {% endif %}
        <!-- Anchor for auto-scroll -->
        <div id="scroll-anchor"></div>
    </div>

    <!-- Input Area -->
    <form hx-post="/group/{{ group_id }}/chat/{{ other_user.id }}" 
          hx-target="closest div" 
          hx-swap="outerHTML" 
          class="p-3 bg-black/20 border-t border-white/10 flex gap-2">
        <input type="text" name="content" autocomplete="off" placeholder="Escribe un mensaje..." required
               class="flex-1 bg-black/20 border border-white/10 rounded-full px-4 py-2 text-sm text-white focus:border-indigo-500 outline-none transition-colors">
        <button type="submit" class="bg-indigo-500 hover:bg-indigo-400 text-white w-10 h-10 rounded-full flex items-center justify-center transition-transform hover:scale-105 shadow-lg">
            <i class="ph-fill ph-paper-plane-right"></i>
        </button>
    </form>

    <script>
        // Auto scroll to bottom
        var messagesDiv = document.getElementById('chat-messages');
        if (messagesDiv) {
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</div>