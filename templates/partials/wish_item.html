<div class="glass-panel rounded-xl overflow-hidden group flex flex-col h-full hover:bg-white/5 transition-all duration-300 border border-white/5 hover:border-white/20 relative" id="wish-{{ wish.id }}">
    
    <!-- Status Badge (Absolute) -->
    {% if wish.reserved_by_id and wish.reserved_by_id != user.id %}
        <div class="absolute top-2 right-2 bg-red-500/80 text-white text-xs px-2 py-1 rounded-md backdrop-blur-sm shadow-sm z-10 font-bold uppercase tracking-wider">
            Reservado
        </div>
    {% elif wish.reserved_by_id == user.id %}
        <div class="absolute top-2 right-2 bg-green-500/80 text-white text-xs px-2 py-1 rounded-md backdrop-blur-sm shadow-sm z-10 font-bold uppercase tracking-wider">
            Reservado por ti
        </div>
    {% endif %}

    <!-- Image -->
    {% if wish.image_url %}
    <div class="h-40 w-full overflow-hidden bg-black/20">
        <img src="{{ wish.image_url }}" alt="{{ wish.title }}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500">
    </div>
    {% else %}
    <div class="h-24 w-full bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center opacity-50 group-hover:opacity-70 transition-opacity">
        <i class="ph-duotone ph-gift text-4xl text-gray-600"></i>
    </div>
    {% endif %}

    <!-- Content -->
    <div class="p-4 flex flex-col flex-grow">
        <h4 class="font-semibold text-white mb-1 line-clamp-2 min-h-[1.5em]">{{ wish.title }}</h4>
        
        <div class="mt-auto pt-4 space-y-2">
            <!-- Link Button -->
            {% if wish.url %}
            <a href="{{ wish.url }}" target="_blank" class="block w-full text-center bg-white/5 hover:bg-white/10 border border-white/10 text-xs py-2 rounded-lg transition-colors text-gray-300 hover:text-white flex items-center justify-center gap-1">
                Ver en Tienda <i class="ph-bold ph-arrow-square-out"></i>
            </a>
            {% endif %}

            <!-- Action Buttons Logic -->
            {% if user %}
                {% if wish.user_id == user.id %}
                    <!-- Es MI deseo -->
                    <button hx-delete="/wishes/{{ wish.id }}" 
                            hx-target="#wish-{{ wish.id }}" 
                            hx-swap="outerHTML"
                            hx-confirm="Â¿Seguro que quieres borrar este deseo?"
                            class="w-full text-red-400 hover:text-red-300 text-xs py-1 transition-colors flex items-center justify-center gap-1 opacity-60 hover:opacity-100">
                        <i class="ph-bold ph-trash"></i> Eliminar
                    </button>
                {% else %}
                    <!-- Es deseo de OTRO -->
                    <div id="reserve-btn-{{ wish.id }}">
                        {% include "partials/reserve_button.html" %}
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>