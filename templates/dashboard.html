{% extends "base.html" %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-12 gap-8">
    
    <!-- Left Column: Actions & Groups (3/12 cols) -->
    <div class="md:col-span-4 lg:col-span-3 space-y-6">
        
        <!-- Create Group Card -->
        <div class="glass-panel rounded-2xl p-6">
            <h3 class="text-lg font-bold mb-4 flex items-center text-indigo-300">
                <i class="ph-fill ph-users-three mr-2"></i> Nuevo Grupo
            </h3>
            <form action="/create-group" method="POST" class="space-y-4">
                <div>
                    <input type="text" name="name" required placeholder="Nombre (ej. Familia)" 
                           class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-sm focus:border-indigo-500 outline-none text-white placeholder-gray-500 transition-colors">
                </div>
                
                <!-- Nuevos Campos Logística -->
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" name="budget" placeholder="Max €" 
                           class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-sm focus:border-indigo-500 outline-none text-white placeholder-gray-500 transition-colors"
                           title="Presupuesto máximo">
                    
                    <input type="date" name="event_date" 
                           class="w-full bg-black/20 border border-white/10 rounded-xl px-2 py-2.5 text-sm focus:border-indigo-500 outline-none text-white placeholder-gray-500 transition-colors dark-calendar">
                </div>

                <div>
                    <input type="text" name="emails" placeholder="Emails (separados por coma)" 
                           class="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-2.5 text-sm focus:border-indigo-500 outline-none text-white placeholder-gray-500 transition-colors">
                </div>

                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-indigo-900/30 transition-all hover:scale-[1.02]">
                    Crear Nuevo Grupo
                </button>
            </form>
            
            <div class="mt-6 pt-6 border-t border-white/10">
                 <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">¿Tienes un código?</h4>
                 <form onsubmit="event.preventDefault(); window.location.href='/join/'+this.code.value" class="flex gap-2">
                     <input type="text" name="code" placeholder="CÓDIGO" class="w-full bg-black/20 border border-white/10 rounded-xl px-3 py-2 text-sm text-white font-mono uppercase placeholder-gray-600 focus:border-gray-500 outline-none">
                     <button type="submit" class="bg-white/10 hover:bg-white/20 px-3 rounded-xl transition-colors"><i class="ph-bold ph-arrow-right"></i></button>
                 </form>
            </div>
        </div>

        <!-- My Groups List -->
        <div>
            <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 px-1">Mis Eventos y Listas</h3>
            <div class="space-y-3">
                {% if user.groups %}
                    {% for group in user.groups %}
                    <a href="/group/{{ group.id }}" class="block glass-panel p-4 rounded-xl hover:bg-white/10 transition-all group border border-transparent hover:border-white/20">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-semibold text-white group-hover:text-indigo-300 transition-colors">{{ group.name }}</span>
                            <i class="ph ph-caret-right text-gray-600 group-hover:text-white transition-colors"></i>
                        </div>
                        <div class="flex items-center gap-3 text-xs text-gray-500 font-mono">
                            <span><i class="ph-bold ph-hash"></i> {{ group.code }}</span>
                            {% if group.event_date %}
                                <span class="text-indigo-400"><i class="ph-bold ph-calendar"></i> {{ group.event_date.strftime('%d/%m') }}</span>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-8 text-gray-500 bg-white/5 rounded-xl border border-dashed border-white/10">
                        <p class="text-sm">No tienes grupos aún.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Right Column: My Wishlist (9/12 cols) -->
    <div class="md:col-span-8 lg:col-span-9">
        <div class="glass-panel rounded-2xl p-6 md:p-8 min-h-[600px] flex flex-col">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                <h2 class="text-2xl font-bold flex items-center">
                    <div class="bg-yellow-500/20 p-2 rounded-lg mr-3">
                        <i class="ph-fill ph-star text-yellow-400"></i>
                    </div>
                    Mi Lista de Deseos
                </h2>
                <a href="/p/{{ user.id }}" target="_blank" class="text-sm bg-pink-500/10 text-pink-300 hover:text-white hover:bg-pink-500 border border-pink-500/30 px-4 py-2 rounded-lg transition-all flex items-center font-medium">
                    Ver perfil público <i class="ph-bold ph-arrow-square-out ml-2"></i>
                </a>
            </div>

            <!-- Add Wish Form -->
            <form hx-post="/wishes" hx-target="#wishlist-container" hx-swap="beforeend" 
                  class="flex gap-3 mb-10"
                  _="on htmx:afterRequest reset() me">
                <div class="relative flex-grow group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <i class="ph-bold ph-link text-gray-500 group-focus-within:text-pink-500 transition-colors"></i>
                    </div>
                    <input type="text" name="content" required 
                           placeholder="Pega un enlace de Amazon o escribe tu deseo..." 
                           class="w-full bg-black/20 border border-white/10 rounded-xl pl-11 pr-5 py-4 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none text-white transition-all placeholder-gray-500">
                </div>
                <button type="submit" class="bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white px-8 rounded-xl font-bold shadow-lg shadow-pink-900/20 transition-all hover:scale-105 flex items-center whitespace-nowrap">
                    <i class="ph-bold ph-plus mr-2"></i> Añadir
                </button>
            </form>

            <!-- Wishes Grid -->
            <div id="wishlist-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr">
                {% for wish in user.wishes %}
                    {% include "partials/wish_item.html" %}
                {% endfor %}
            </div>
            
            <div id="recommendations-block" class="mt-12 pt-8 border-t border-white/10">
                <div class="flex justify-between items-end mb-6">
                    <h3 class="text-xl font-bold flex items-center text-orange-300">
                        <i class="ph-fill ph-fire mr-2"></i> Lo más regalado este año
                    </h3>
                    <a href="/ideas" class="text-sm text-indigo-300 hover:text-white flex items-center gap-1 transition-colors">
                        Ver todo <i class="ph-bold ph-arrow-right"></i>
                    </a>
                </div>
                
                <!-- Carousel Container -->
                <div class="flex overflow-x-auto gap-4 pb-6 snap-x snap-mandatory scrollbar-hide">
                    {% for item in recommendations %}
                    <div class="min-w-[220px] max-w-[220px] snap-center bg-white/5 rounded-xl overflow-hidden hover:bg-white/10 transition-colors flex flex-col border border-white/5 shadow-lg">
                        <!-- Image -->
                        <div class="h-40 overflow-hidden relative bg-white">
                             <img src="{{ item.image }}" alt="{{ item.title }}" loading="lazy" class="w-full h-full object-contain p-2">
                             <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
                                 <span class="text-xs font-bold text-white bg-green-600 px-2 py-0.5 rounded-full shadow-sm">{{ item.price }}</span>
                             </div>
                        </div>
                        <!-- Body -->
                        <div class="p-3 flex flex-col flex-grow">
                            <h4 class="font-bold text-sm text-gray-200 mb-2 line-clamp-2 leading-tight flex-grow" title="{{ item.title }}">{{ item.title }}</h4>
                            <div class="flex gap-2 mt-2">
                                <a href="{{ item.url }}" target="_blank" class="flex-1 bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-500 text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors">
                                    <i class="ph-bold ph-amazon-logo"></i>
                                </a>
                                <form hx-post="/wishes" hx-target="#wishlist-container" hx-swap="beforeend" class="flex-1">
                                    <input type="hidden" name="content" value="{{ item.url }}">
                                    <input type="hidden" name="manual_title" value="{{ item.title }}">
                                    <input type="hidden" name="manual_image" value="{{ item.image }}">
                                    <button type="submit" class="w-full bg-white/10 hover:bg-white/20 text-white text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors" title="Añadir a mi lista">
                                        <i class="ph-bold ph-plus"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {% if trending_items %}
            <div class="mt-8 pt-8 border-t border-white/10">
                <div class="flex items-center justify-between mb-4 px-2">
                    <h3 class="text-xl font-bold text-green-300 flex items-center gap-2">
                        <i class="ph-fill ph-trend-up"></i> Tendencias del Momento
                    </h3>
                    <a href="/trends" class="text-sm font-medium text-pink-400 hover:text-pink-300 hover:underline transition-colors">
                        Ver todo <span>&rarr;</span>
                    </a>
                </div>
                <!-- Carousel Container -->
                <div class="flex overflow-x-auto gap-4 pb-6 snap-x snap-mandatory scrollbar-hide">
                    {% for item in trending_items %}
                    <div class="min-w-[220px] max-w-[220px] snap-center bg-white/5 rounded-xl overflow-hidden hover:bg-white/10 transition-colors flex flex-col border border-white/5 shadow-lg">
                        <!-- Image -->
                        <div class="h-40 overflow-hidden relative bg-white">
                            <img src="{{ item.image }}" alt="{{ item.title }}" loading="lazy" class="w-full h-full object-contain p-2">
                             <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
                                 <span class="text-xs font-bold text-white bg-green-600 px-2 py-0.5 rounded-full shadow-sm">{{ item.price }}</span>
                             </div>
                        </div>
                        <!-- Body -->
                        <div class="p-3 flex flex-col flex-grow">
                            <h4 class="font-bold text-sm text-gray-200 mb-2 line-clamp-2 leading-tight flex-grow" title="{{ item.title }}">{{ item.title }}</h4>
                            <div class="flex gap-2 mt-2">
                                 <a href="{{ item.url }}" target="_blank" class="flex-1 bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-500 text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors">
                                    <i class="ph-bold ph-amazon-logo"></i>
                                </a>
                                <form hx-post="/wishes" hx-target="#wishlist-container" hx-swap="beforeend" class="flex-1">
                                    <input type="hidden" name="content" value="{{ item.url }}">
                                    <input type="hidden" name="manual_title" value="{{ item.title }}">
                                    <input type="hidden" name="manual_image" value="{{ item.image }}">
                                    <button type="submit" class="w-full bg-white/10 hover:bg-white/20 text-white text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors" title="Añadir a mi lista">
                                        <i class="ph-bold ph-plus"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if desired_items %}
            <div class="mt-8 pt-8 border-t border-white/10">
                <div class="flex items-center justify-between mb-4 px-2">
                    <h3 class="text-xl font-bold text-red-300 flex items-center gap-2">
                        <i class="ph-fill ph-heart"></i> Los Más Deseados
                    </h3>
                    <a href="/most-desired" class="text-sm font-medium text-pink-400 hover:text-pink-300 hover:underline transition-colors">
                        Ver todo <span>&rarr;</span>
                    </a>
                </div>
                <!-- Carousel Container -->
                <div class="flex overflow-x-auto gap-4 pb-6 snap-x snap-mandatory scrollbar-hide">
                    {% for item in desired_items %}
                    <div class="min-w-[220px] max-w-[220px] snap-center bg-white/5 rounded-xl overflow-hidden hover:bg-white/10 transition-colors flex flex-col border border-white/5 shadow-lg">
                        <!-- Image -->
                        <div class="h-40 overflow-hidden relative bg-white">
                            <img src="{{ item.image }}" alt="{{ item.title }}" loading="lazy" class="w-full h-full object-contain p-2">
                             <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-2">
                                 <span class="text-xs font-bold text-white bg-red-600 px-2 py-0.5 rounded-full shadow-sm">{{ item.price }}</span>
                             </div>
                        </div>
                        <!-- Body -->
                        <div class="p-3 flex flex-col flex-grow">
                            <h4 class="font-bold text-sm text-gray-200 mb-2 line-clamp-2 leading-tight flex-grow" title="{{ item.title }}">{{ item.title }}</h4>
                            <div class="flex gap-2 mt-2">
                                 <a href="{{ item.url }}" target="_blank" class="flex-1 bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-500 text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors">
                                    <i class="ph-bold ph-amazon-logo"></i>
                                </a>
                                <form hx-post="/wishes" hx-target="#wishlist-container" hx-swap="beforeend" class="flex-1">
                                    <input type="hidden" name="content" value="{{ item.url }}">
                                    <input type="hidden" name="manual_title" value="{{ item.title }}">
                                    <input type="hidden" name="manual_image" value="{{ item.image }}">
                                    <button type="submit" class="w-full bg-white/10 hover:bg-white/20 text-white text-xs font-bold py-2 px-2 rounded-lg text-center transition-colors" title="Añadir a mi lista">
                                        <i class="ph-bold ph-plus"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if not user.wishes %}
            <div id="empty-state" class="flex-grow flex flex-col items-center justify-center text-gray-500 py-12">
                <i class="ph-duotone ph-gift text-6xl mb-4 opacity-30"></i>
                <p>Tu lista está vacía. ¡Añade algo para empezar!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Estilo básico para el calendario oscuro */
    .dark-calendar {
        color-scheme: dark;
    }
</style>
{% endblock %}